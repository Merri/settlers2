!function(t){function e(a){if(n[a])return n[a].exports;var i=n[a]={exports:{},id:a,loaded:!1};return t[a].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="/public",e(0)}([function(t,e,n){t.exports=n(10)},function(t,e,n){"use strict";function a(t){function e(t){return null===l?void h.push(t):void r(function(){var e=l?t.onFulfilled:t.onRejected;if(null===e)return void(l?t.resolve:t.reject)(u);var n;try{n=e(u)}catch(a){return void t.reject(a)}t.resolve(n)})}function n(t){try{if(t===E)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var e=t.then;if("function"==typeof e)return void o(e.bind(t),n,a)}l=!0,u=t,s()}catch(i){a(i)}}function a(t){l=!1,u=t,s()}function s(){for(var t=0,n=h.length;n>t;t++)e(h[t]);h=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");var l=null,u=null,h=[],E=this;this.then=function(t,n){return new E.constructor(function(a,o){e(new i(t,n,a,o))})},o(t,n,a)}function i(t,e,n,a){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=a}function o(t,e,n){var a=!1;try{t(function(t){a||(a=!0,e(t))},function(t){a||(a=!0,n(t))})}catch(i){if(a)return;a=!0,n(i)}}var r=n(2);t.exports=a},function(t,e,n){(function(e,n){function a(){for(;o.next;){o=o.next;var t=o.task;o.task=void 0;var e=o.domain;e&&(o.domain=void 0,e.enter());try{t()}catch(n){if(u)throw e&&e.exit(),setTimeout(a,0),e&&e.enter(),n;setTimeout(function(){throw n},0)}e&&e.exit()}s=!1}function i(t){r=r.next={task:t,domain:u&&e.domain,next:null},s||(s=!0,l())}var o={task:void 0,next:null},r=o,s=!1,l=void 0,u=!1;if("undefined"!=typeof e&&e.nextTick)u=!0,l=function(){e.nextTick(a)};else if("function"==typeof n)l="undefined"!=typeof window?n.bind(window,a):function(){n(a)};else if("undefined"!=typeof MessageChannel){var h=new MessageChannel;h.port1.onmessage=a,l=function(){h.port2.postMessage(0)}}else l=function(){setTimeout(a,0)};t.exports=i}).call(e,n(6),n(5).setImmediate)},function(t,e){t.exports=React},function(t,e){"use strict";var n={UNUSED:0,LAND:1,WATER:2,IMPASSABLE:254},a={ORIGINAL:[[233,216,123,233,199,240,240,199,231,233,230,216,216,215,236,231,57,254,216,240,57,57,57,255,255,255,255,255,255,255,255,255,255,255,216,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],[114,167,139,160,85,42,42,85,165,166,166,33,212,212,167,114,248,254,160,42,248,248,248,255,255,255,255,255,255,255,255,255,255,255,33,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],[123,116,244,244,183,240,240,183,36,102,123,117,118,118,233,120,248,254,122,240,248,248,248,255,255,255,255,255,255,255,255,255,255,255,117,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]],MERRI:[[236,195,124,231,199,242,242,199,233,232,231,195,194,193,217,232,249,254,169,242,249,249,249,255,255,255,255,255,255,255,255,255,255,255,195,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],[98,145,23,41,85,42,42,85,32,166,33,113,245,41,34,33,251,254,97,42,251,251,251,255,255,255,255,255,255,255,255,255,255,255,113,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],[122,118,179,178,182,242,242,182,122,172,101,120,144,119,171,101,249,252,123,242,249,249,249,255,255,255,255,255,255,255,255,255,255,255,120,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]]},i=[0,9786,9787,9829,9830,9827,9824,8226,9688,9675,9689,9794,9792,9834,9835,9788,9658,9668,8597,8252,182,167,9644,8616,8593,8595,8594,8592,8735,8596,9650,9660,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,8962,199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,162,163,165,8359,402,225,237,243,250,241,209,170,186,191,8976,172,189,188,161,171,187,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,9500,37,37,9566,567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,9604,9612,9616,9600,945,223,915,960,931,963,181,964,934,920,937,948,8734,966,949,8745,8801,177,8805,8804,8992,8993,247,8776,176,8729,183,8730,8319,178,9632,160],o={TREE:196,GRANITE:204,MATCH:252},r={FRESH_WATER:33,COAL:64,IRON_ORE:72,GOLD:80,GRANITE:88,FISH:135},s={FLAG:1,HUT:2,HOUSE:3,CASTLE:4,MINE:5,OCCUPIED:8,FLAG_OCCUPIED:9,HUT_OCCUPIED:10,CASTLE_OCCUPIED:12,MINE_OCCUPIED:13,TREE:104,IMPASSABLE:120},l={GREENLAND:0,WASTELAND:1,WINTERWORLD:2},u={SUPPORT_S2:1,SUPPORT_RTTR:2,ARABLE:4,HABITABLE:8,ARID:16,ROCK:32,WET:64,EXTREME:128,WATER:256,STEPPE:512,SAVANNAH:1024,MEADOW:2048,MOUNT_MEADOW:4096,IMPASSABLE:192,TO_ID_VALUE:63,HARBOR:64,UNKNOWN:128,DROP_SUPPORT:252},h={0:{FLAG:u.SUPPORT_S2|u.SUPPORT_RTTR|u.ARABLE|u.HABITABLE|u.SAVANNAH,NAME:{0:"Savannah",1:"Dark Steppe",2:"Taiga"},X:0,Y:96,WIDTH:37,HEIGHT:31},1:{FLAG:u.SUPPORT_S2|u.SUPPORT_RTTR|u.ROCK,NAME:{0:"Mountain #1",1:"Mountain #1",2:"Mountain #1"},X:0,Y:48,WIDTH:37,HEIGHT:31},2:{FLAG:u.SUPPORT_S2|u.SUPPORT_RTTR|u.EXTREME,NAME:{0:"Snow",1:"Lava Stones",2:"Pack Ice"},X:0,Y:0,WIDTH:37,HEIGHT:31},3:{FLAG:u.SUPPORT_S2|u.SUPPORT_RTTR|u.WET,NAME:{0:"Swamp",1:"Lava Ground",2:"Drift Ice"},X:96,Y:0,WIDTH:37,HEIGHT:31},4:{FLAG:u.SUPPORT_S2|u.SUPPORT_RTTR|u.ARID,NAME:{0:"Desert",1:"Wasteland",2:"Ice"},X:48,Y:0,WIDTH:37,HEIGHT:31},5:{FLAG:u.SUPPORT_S2|u.SUPPORT_RTTR|u.WET|u.WATER,NAME:{0:"Water",1:"Moor",2:"Water"},X:201,Y:59,WIDTH:37,HEIGHT:31},6:{FLAG:u.SUPPORT_S2|u.HABITABLE,NAME:{0:"Habitable Water",1:"Habitable Moor",2:"Habitable Water"},X:201,Y:59,WIDTH:37,HEIGHT:31},7:{FLAG:u.SUPPORT_S2|u.SUPPORT_RTTR|u.ARID,NAME:{0:"Clone Desert",1:"Clone Wasteland",2:"Clone Ice"},X:48,Y:0,WIDTH:37,HEIGHT:31},8:{FLAG:u.SUPPORT_S2|u.SUPPORT_RTTR|u.ARABLE|u.HABITABLE|u.MEADOW,NAME:{0:"Meadow #1",1:"Pasture #1",2:"Taiga / Tundra"},X:48,Y:96,WIDTH:37,HEIGHT:31},9:{FLAG:u.SUPPORT_S2|u.SUPPORT_RTTR|u.ARABLE|u.HABITABLE|u.MEADOW,NAME:{0:"Meadow #2",1:"Pasture #2",2:"Tundra #1"},X:96,Y:96,WIDTH:37,HEIGHT:31},10:{FLAG:u.SUPPORT_S2|u.SUPPORT_RTTR|u.ARABLE|u.HABITABLE|u.MEADOW,NAME:{0:"Meadow #3",1:"Pasture #3",2:"Tundra #2"},X:144,Y:96,WIDTH:37,HEIGHT:31},11:{FLAG:u.SUPPORT_S2|u.SUPPORT_RTTR|u.ROCK,NAME:{0:"Mountain #2",1:"Mountain #2",2:"Mountain #2"},X:48,Y:48,WIDTH:37,HEIGHT:31},12:{FLAG:u.SUPPORT_S2|u.SUPPORT_RTTR|u.ROCK,NAME:{0:"Mountain #3",1:"Mountain #3",2:"Mountain #3"},X:96,Y:48,WIDTH:37,HEIGHT:31},13:{FLAG:u.SUPPORT_S2|u.SUPPORT_RTTR|u.ROCK,NAME:{0:"Mountain #4",1:"Mountain #4",2:"Mountain #4"},X:144,Y:48,WIDTH:37,HEIGHT:31},14:{FLAG:u.SUPPORT_S2|u.SUPPORT_RTTR|u.ARABLE|u.HABITABLE|u.STEPPE,NAME:{0:"Steppe",1:"Light Steppe",2:"Tundra #3"},X:0,Y:144,WIDTH:37,HEIGHT:31},15:{FLAG:u.SUPPORT_S2|u.SUPPORT_RTTR|u.ARABLE|u.HABITABLE|u.MEADOW,NAME:{0:"Flower Meadow",1:"Flower Pasture",2:"Tundra #4"},X:144,Y:0,WIDTH:37,HEIGHT:31},16:{FLAG:u.SUPPORT_S2|u.SUPPORT_RTTR|u.EXTREME,NAME:{0:"Lava",1:"Lava",2:"Lava"},X:201,Y:116,WIDTH:37,HEIGHT:31},17:{FLAG:u.SUPPORT_S2|u.ARID,NAME:{0:"Solid Color (Magenta)",1:"Solid Color (Dark Red)",2:"Solid Color (Black)"},X:0,Y:254,WIDTH:1,HEIGHT:1},18:{FLAG:u.SUPPORT_S2|u.SUPPORT_RTTR|u.HABITABLE|u.MOUNT_MEADOW,NAME:{0:"Mountain Meadow",1:"Alpine Pasture",2:"Snow"},X:48,Y:144,WIDTH:37,HEIGHT:31},19:{FLAG:u.SUPPORT_S2|u.EXTREME,NAME:{0:"Border Water",1:"Border Moor",2:"Border Water"},X:201,Y:59,WIDTH:37,HEIGHT:31},20:{FLAG:u.SUPPORT_S2|u.EXTREME,NAME:{0:"Solid Color Lava #1 (Magenta)",1:"Solid Color Lava #1 (Dark Red)",2:"Solid Color Lava #1 (Black)"},X:64,Y:221,WIDTH:34,HEIGHT:34},21:{FLAG:u.SUPPORT_S2|u.EXTREME,NAME:{0:"Solid Color Lava #2 (Magenta)",1:"Solid Color Lava #2 (Dark Red)",2:"Solid Color Lava #2 (Black)"},X:98,Y:221,WIDTH:34,HEIGHT:34},22:{FLAG:u.SUPPORT_S2|u.EXTREME,NAME:{0:"Solid Color Lava #3 (Magenta)",1:"Solid Color Lava #3 (Dark Red)",2:"Solid Color Lava #3 (Black)"},X:132,Y:221,WIDTH:34,HEIGHT:34},34:{FLAG:u.SUPPORT_S2|u.HABITABLE|u.MOUNT_MEADOW,NAME:{0:"Mountain #2 (Habitable)",1:"Mountain #2 (Habitable)",2:"Mountain #2 (Habitable)"},X:48,Y:48,WIDTH:37,HEIGHT:31}},E=[[{RED:21,GREEN:73,BLUE:15,ALPHA:.6235294117647059,NAME:"Pine"},{RED:23,GREEN:70,BLUE:27,ALPHA:.5568627450980392,NAME:"Birch"},{RED:21,GREEN:65,BLUE:16,ALPHA:.7019607843137254,NAME:"Oak"},{RED:48,GREEN:87,BLUE:24,ALPHA:.3254901960784314,NAME:"Palm 1"},{RED:42,GREEN:78,BLUE:19,ALPHA:.2549019607843137,NAME:"Palm 2"},{RED:34,GREEN:73,BLUE:19,ALPHA:.36470588235294116,NAME:"Pine Apple"},{RED:34,GREEN:71,BLUE:18,ALPHA:.4588235294117647,NAME:"Cypress"},{RED:131,GREEN:53,BLUE:36,ALPHA:.3843137254901961,NAME:"Cherry"},{RED:20,GREEN:78,BLUE:18,ALPHA:.4627450980392157,NAME:"Fir"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #1"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #2"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #3"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #4"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #5"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #6"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #7"}],[{RED:117,GREEN:80,BLUE:62,ALPHA:.3843137254901961,NAME:"Spider"},{RED:127,GREEN:70,BLUE:49,ALPHA:.4549019607843137,NAME:"Marley"},{RED:117,GREEN:80,BLUE:62,ALPHA:.3843137254901961,NAME:"Clone Spider #1"},{RED:127,GREEN:70,BLUE:49,ALPHA:.4549019607843137,NAME:"Clone Marley #1"},{RED:117,GREEN:80,BLUE:62,ALPHA:.3843137254901961,NAME:"Clone Spider #2"},{RED:34,GREEN:73,BLUE:19,ALPHA:.36470588235294116,NAME:"Pine Apple"},{RED:117,GREEN:80,BLUE:62,ALPHA:.3843137254901961,NAME:"Clone Spider #3"},{RED:131,GREEN:53,BLUE:36,ALPHA:.3843137254901961,NAME:"Cherry"},{RED:127,GREEN:70,BLUE:49,ALPHA:.4549019607843137,NAME:"Clone Marley #2"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #1"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #2"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #3"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #4"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #5"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #6"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #7"}],[{RED:88,GREEN:99,BLUE:77,ALPHA:.5019607843137255,NAME:"Pine"},{RED:63,GREEN:82,BLUE:58,ALPHA:.49019607843137253,NAME:"Birch"},{RED:77,GREEN:94,BLUE:60,ALPHA:.40784313725490196,NAME:"Fir"},{RED:48,GREEN:87,BLUE:24,ALPHA:.3254901960784314,NAME:"Palm 1"},{RED:42,GREEN:78,BLUE:19,ALPHA:.2549019607843137,NAME:"Palm 2"},{RED:34,GREEN:73,BLUE:19,ALPHA:.36470588235294116,NAME:"Pine Apple"},{RED:83,GREEN:85,BLUE:58,ALPHA:.4117647058823529,NAME:"Cypress"},{RED:77,GREEN:94,BLUE:60,ALPHA:.40784313725490196,NAME:"Clone Fir #1"},{RED:77,GREEN:94,BLUE:60,ALPHA:.40784313725490196,NAME:"Clone Fir #2"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #1"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #2"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #3"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #4"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #5"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #6"},{RED:0,GREEN:0,BLUE:0,ALPHA:.1,NAME:"Unused #7"}]];t.exports={AREA:n,CP437:i,COLOR:a,OBJECT_TYPE:o,RESOURCE:r,SITE:s,TERRAIN:l,TEXTURE:u,TEXTURE_INFO:h,TREE_INFO:E}},function(t,e,n){(function(t,a){function i(t,e){this._id=t,this._clearFn=e}var o=n(6).nextTick,r=Function.prototype.apply,s=Array.prototype.slice,l={},u=0;e.setTimeout=function(){return new i(r.call(setTimeout,window,arguments),clearTimeout)},e.setInterval=function(){return new i(r.call(setInterval,window,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},e.setImmediate="function"==typeof t?t:function(t){var n=u++,a=arguments.length<2?!1:s.call(arguments,1);return l[n]=!0,o(function(){l[n]&&(a?t.apply(null,a):t.call(null),e.clearImmediate(n))}),n},e.clearImmediate="function"==typeof a?a:function(t){delete l[t]}}).call(e,n(5).setImmediate,n(5).clearImmediate)},function(t,e){function n(){u=!1,r.length?l=r.concat(l):h=-1,l.length&&a()}function a(){if(!u){var t=setTimeout(n);u=!0;for(var e=l.length;e;){for(r=l,l=[];++h<e;)r[h].run();h=-1,e=l.length}r=null,u=!1,clearTimeout(t)}}function i(t,e){this.fun=t,this.array=e}function o(){}var r,s=t.exports={},l=[],u=!1,h=-1;s.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];l.push(new i(t,e)),1!==l.length||u||setTimeout(a,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=o,s.addListener=o,s.once=o,s.off=o,s.removeListener=o,s.removeAllListeners=o,s.emit=o,s.binding=function(t){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(t){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(t,e,n){"use strict";var a=n(3);t.exports=a.createClass({displayName:"exports",getInitialState:function(){return{value:0}},getDefaultProps:function(){return{minimumValue:1,maximumValue:99,value:50}},componentWillReceiveProps:function(t){t&&this.setState({value:~~t.value})},handleDecrease:function(t){t.preventDefault();var e=~~this.state.value-1;e<this.props.minimumValue&&(e=~~this.props.minimumValue),this.setState({value:e},function(){this.props.onChange(e)})},handleIncrease:function(t){t.preventDefault();var e=~~this.state.value+1;e>this.props.maximumValue&&(e=~~this.props.maximumValue),this.setState({value:e},function(){this.props.onChange(e)})},handleChange:function(t){var e=t.target.value;e.length>0?(e=~~parseInt(e,10),e<this.props.minimumValue?e=this.state.value:e>this.props.maximumValue&&(e=this.state.value),this.setState({value:""+e},function(){this.props.onChange(e)})):this.setState({value:e})},render:function(){return a.createElement("span",{className:"inc-dec"},a.createElement("button",{className:"inc-dec__decrease",type:"button",onClick:this.handleDecrease},"-"),a.createElement("input",{className:"inc-dec__input",type:"text",onChange:this.handleChange,value:this.state.value}),a.createElement("button",{className:"inc-dec__increase",type:"button",onClick:this.handleIncrease},"+"))}})},function(t,e,n){"use strict";var a=n(3),i=n(4),o=i.TEXTURE_INFO;t.exports=a.createClass({displayName:"exports",getInitialState:function(){return{texture:0}},getDefaultProps:function(){return{texture:0,textures:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,34]}},componentWillReceiveProps:function(t){this.setState({texture:t.texture})},handleChange:function(t){var e=~~t.target.value;this.setState({texture:e}),this.props.onChange(e)},render:function(){var t=this.props.textures.map(function(t){var e=this.state.texture===t,n="texture-option texture-option--terrain"+this.props.terrain,i=o[t],r=Math.max(50/i.WIDTH,50/i.HEIGHT),s={backgroundPosition:~~(-i.X*r)+"px "+~~(-i.Y*r)+"px",backgroundSize:~~(256*r)+"px "+~~(256*r)+"px"},l=i.NAME[this.props.terrain];return e&&(n+=" texture-option--selected"),a.createElement("li",{className:n,title:l},a.createElement("label",{className:"texture-option__label",style:s},a.createElement("input",{className:"texture-option__input",checked:e,onChange:this.handleChange,type:"radio",value:t}),a.createElement("span",{className:"texture-option__name"},l)))}.bind(this));return a.createElement("ul",{className:"texture-option-list"},t)}})},function(t,e,n){"use strict";var a=n(3);t.exports=a.createClass({displayName:"exports",render:function(){return a.createElement("div",null,a.createElement("h2",null,"Unsupported browser!"),a.createElement("p",null,"Unfortunatenaly the browser you use is far too old to be supported."),a.createElement("h3",null,"Supported browsers:"),a.createElement("ul",null,a.createElement("li",null,"Firefox 4 or later"),a.createElement("li",null,"Chrome 7 or later"),a.createElement("li",null,"Internet Explorer 10 or later"),a.createElement("li",null,"IE Mobile 10 or later"),a.createElement("li",null,"Safari 5.1 or later (Windows / OSX)"),a.createElement("li",null,"Safari 4.3 or later (iOS)"),a.createElement("li",null,"Android Browser 4 or later"),a.createElement("li",null,"Opera 11.6 or later"),a.createElement("li",null,"Opera Mobile 12 or later"),a.createElement("li",null,"Blackberry Browser 10 or later")))}})},function(t,e,n){"use strict";function a(){return u.applyResources({})}var i=n(3),o=n(11),r=n(7),s=n(8),l=n(9),u=new o,h=i.createClass({displayName:"App",getInitialState:function(){return{hasLocalStorage:!1,meetsRequirements:!!window.ArrayBuffer&&!!window.Uint8Array&&!!window.Uint32Array,compatibility:"return-to-the-roots",maxPlayers:7,playerMinDistance:50,players:[],resources:{},viewType:11,heightOptions:{baseLevel:5,flatten:25,groundLevel:3,randomize:.3,noiseOnWater:!1},seedOptions:{width:160,height:160,borderProtection:8,likelyhood:[0,.004,.024,.64,.48,.48,.48],massRatio:50,startingPoints:60},textureOptions:{mountainGenerate:6,seamless:!1,terrain:0,texture:8,waterTexture:5},height:160,width:160,title:"Untitled"}},componentWillMount:function(){var t=!1;if(this.state.meetsRequirements){try{t=!!localStorage}catch(e){}t&&(localStorage.width&&(this.state.seedOptions.width=~~localStorage.width),localStorage.height&&(this.state.seedOptions.height=~~localStorage.height)),this.setState({hasLocalStorage:t,width:this.state.seedOptions.width,height:this.state.seedOptions.height}),u.setColorMap("alternative").then(function(){this.setState({viewType:"pretty"}),this.handleSeed()}.bind(this),this.handleSeed)}},generateHeightMap:function(){u.createHeight(this.state.heightOptions)},generateTextures:function(){u.createBaseTextures(this.state.textureOptions)},handleDraw:function(){console.time("Draw"),u.draw({canvas:this.refs.canvas.getDOMNode(),terrain:this.state.textureOptions.terrain,viewType:this.state.viewType}),u.draw({canvas:this.refs.seed.getDOMNode(),viewType:"seed"}),console.timeEnd("Draw")},handleSeed:function(){console.time("New Seed, Height Map, Textures and Resources"),this.state.seedOptions.startingPoints=.2*(this.state.seedOptions.width+this.state.seedOptions.height),this.state.seedOptions.likelyhood=[0,5e-6*(this.state.seedOptions.width+this.state.seedOptions.height)+.001,15e-6*(this.state.seedOptions.width+this.state.seedOptions.height)+.01,5e-4*(this.state.seedOptions.width+this.state.seedOptions.height)+.5,2e-4*(this.state.seedOptions.width+this.state.seedOptions.height)+.4,2e-4*(this.state.seedOptions.width+this.state.seedOptions.height)+.4,2e-4*(this.state.seedOptions.width+this.state.seedOptions.height)+.4],this.state.hasLocalStorage&&(localStorage.width=this.state.seedOptions.width,localStorage.height=this.state.seedOptions.height),this.setState({width:this.state.seedOptions.width,height:this.state.seedOptions.height},function(){u.seed(this.state.seedOptions),this.generateHeightMap(),this.generateTextures(),this.setState({players:[],resources:a()}),console.timeEnd("New Seed, Height Map, Textures and Resources"),this.handleDraw()})},handleLandscape:function(){console.time("Height Map, Textures and Resources"),this.generateHeightMap(),this.generateTextures(),this.setState({players:[],resources:[]}),console.timeEnd("Height Map, Textures and Resources"),this.handleDraw()},handleResources:function(){console.time("Resources"),this.setState({players:[],resources:a()}),console.timeEnd("Resources"),this.handleDraw()},handlePlayers:function(){console.time("Players"),this.setState({players:u.getRandomPlayerPositions(this.state.maxPlayers,this.state.playerMinDistance)}),console.timeEnd("Players"),this.handleDraw()},handleDownload:function(){saveAs(u.getFileBlob({terrain:this.state.textureOptions.terrain,title:this.state.title}),this.state.title.replace(/[\|&;\$%@"<>\(\)\+,]/g,"_")+".swd")},handleCompatibility:function(t){this.setState({compatibility:t})},handleSetWidth:function(t){this.state.seedOptions.width=~~t.target.value,this.setState({seedOptions:this.state.seedOptions})},handleSetHeight:function(t){this.state.seedOptions.height=~~t.target.value,this.setState({seedOptions:this.state.seedOptions})},handleTerrain:function(t){this.state.textureOptions.terrain=~~t.target.value,this.generateTextures(),this.setState({players:[],resources:[]}),this.handleDraw()},handleMassRatio:function(t){this.state.seedOptions.massRatio=~~t},handleBaseLevel:function(t){t=~~t,this.state.heightOptions.baseLevel!==t&&(this.state.heightOptions.baseLevel=t,this.handleLandscape())},handleGroundLevel:function(t){t=~~t,this.state.heightOptions.groundLevel!==t&&(this.state.heightOptions.groundLevel=t,this.handleLandscape())},handleFlatten:function(t){t=~~t,this.state.heightOptions.flatten!==t&&(this.state.heightOptions.flatten=t,this.handleLandscape())},handleNoise:function(t){t=~~t?~~t/10:0,this.state.heightOptions.randomize!==t&&(this.state.heightOptions.randomize=t,this.handleLandscape())},handlePlayerMinDistance:function(t){this.setState({playerMinDistance:~~t})},handleNoiseOnWater:function(t){this.state.heightOptions.noiseOnWater=t.target.checked,this.handleLandscape()},handleViewTypeChange:function(t){var e=t.target.value;e===""+~~e&&(e=~~e),this.setState({viewType:e},this.handleDraw)},handleTitleChange:function(t){this.setState({title:u.sanitizeStringAsCP437(t.target.value)})},isRttROnly:function(t){return this.state.width>256||this.state.height>256||t.length>250},handleFirefoxOnChangeInKeyDown:function(t){var e=t.target;setTimeout(function(){e.blur(),e.focus()})},handleMaxPlayerChange:function(t){this.setState({maxPlayers:~~t.target.value})},handlePlayableTexture:function(t){this.state.textureOptions.texture=t,this.handleLandscape()},handleUnPlayableTexture:function(t){this.state.textureOptions.waterTexture=t,this.handleLandscape()},render:function(){if(!this.state.meetsRequirements)return i.createElement(l,null);var t=this.state.resources.mineGold||0,e=this.state.resources.mineCoal||0,n=this.state.resources.mineIronOre||0,a=this.state.resources.mineGranite||0,o=t+e+n+a+1e-4,h=this.state.players.map(function(t,e){var n="player-position",a={left:t.x+"px",top:t.y+"px"};return e>6&&(n+=" "+n+"--rttr"),i.createElement("i",{className:n,id:"player"+e,style:a})}),E=u.getAreas()||[],c=E.reduce(function(t,e,n,a){return 1===e.type?t.land++:2===e.type&&t.water++,t},{land:0,water:0}),f="settlers2-map";switch(f+=" "+f+"--",this.state.textureOptions.terrain){case 1:f+="wasteland";break;case 2:f+="winter-world";break;default:f+="greenland"}return i.createElement("div",null,i.createElement("p",null,i.createElement("span",{className:"input-container","data-chars-remaining":19-this.state.title.length},i.createElement("input",{className:"settlers2-map-title",type:"text",maxLength:"19",value:this.state.title,onChange:this.handleTitleChange,placeholder:"Title"})),i.createElement("br",null),i.createElement("button",{onClick:this.handleDownload},"Download")," ",i.createElement("small",{className:"settlers2-playable-on"},"Map is playable on ",this.isRttROnly(E)?i.createElement("b",null,"Return to the Roots only"):i.createElement("span",null,"The Settlers II & Return to the Roots"))),i.createElement("div",{className:"player-positions"},i.createElement("canvas",{width:this.state.width,height:this.state.height,ref:"seed",className:"settlers2-map"}),i.createElement("canvas",{width:this.state.width,height:this.state.height,ref:"canvas",className:f}),h),i.createElement("ul",{className:"seed-options"},i.createElement("li",null,i.createElement("label",null,"Width: ",i.createElement("select",{value:this.state.seedOptions.width,onChange:this.handleSetWidth,onKeyDown:this.handleFirefoxOnChangeInKeyDown},i.createElement("optgroup",{label:"The Settlers II & RttR"},[64,80,96,112,128,144,160,176,192,208,224,240,256].map(function(t){return i.createElement("option",{value:t},t)})),i.createElement("optgroup",{label:"Return to the Roots only"},[320,384,448,512,640,768,1024].map(function(t){return i.createElement("option",{value:t},t)}))))),i.createElement("li",null,i.createElement("label",null,"Height: ",i.createElement("select",{value:this.state.seedOptions.height,onChange:this.handleSetHeight,onKeyDown:this.handleFirefoxOnChangeInKeyDown},i.createElement("optgroup",{label:"The Settlers II & RttR"},[64,80,96,112,128,144,160,176,192,208,224,240,256].map(function(t){return i.createElement("option",{value:t},t)})),i.createElement("optgroup",{label:"Return to the Roots only"},[320,384,448,512,640,768,1024].map(function(t){return i.createElement("option",{value:t},t)}))))),i.createElement("li",null,"Target playable landmass%: ",i.createElement(r,{minimumValue:"1",maximumValue:"99",value:this.state.seedOptions.massRatio,onChange:this.handleMassRatio})),i.createElement("li",null,i.createElement("button",{onClick:this.handleSeed},"New World"))),i.createElement("br",{style:{clear:"both"}}),i.createElement("p",null,i.createElement("label",null,"Display:",i.createElement("select",{value:this.state.viewType,onChange:this.handleViewTypeChange,onKeyDown:this.handleFirefoxOnChangeInKeyDown},i.createElement("optgroup",{label:"World"},i.createElement("option",{value:"fast"},"Settlers II (fast)"),i.createElement("option",{value:"pretty"},"Detailed (slow)")),i.createElement("optgroup",{label:"Raw Data"},i.createElement("option",{value:"0"},"#0: Height Map"),i.createElement("option",{value:"4"},"#4: Object Index"),i.createElement("option",{value:"5"},"#5: Object Type"),i.createElement("option",{value:"8"},"#8: Building Sites"),i.createElement("option",{value:"11"},"#11: Resources"),i.createElement("option",{value:"12"},"#12: Light Map"),i.createElement("option",{value:"13"},"#13: Areas"))))),i.createElement("section",null,i.createElement("header",null,"Landscape Options"),i.createElement("p",null,"These settings allow you to control the base landscape, the main look and feel of the world."),i.createElement("dl",null,i.createElement("dt",null,"Environment:"),i.createElement("dd",null,i.createElement("select",{value:this.state.textureOptions.terrain,onChange:this.handleTerrain,onKeyDown:this.handleFirefoxOnChangeInKeyDown},i.createElement("option",{value:"0"},"Greenland"),i.createElement("option",{value:"1"},"Wasteland"),i.createElement("option",{value:"2"},"Winter World"))),i.createElement("dt",null,"Base Level:"),i.createElement("dd",null,i.createElement(r,{minimumValue:"0",maximumValue:"60",value:""+this.state.heightOptions.baseLevel,onChange:this.handleBaseLevel})),i.createElement("dt",null,"Ground Level:"),i.createElement("dd",null,i.createElement(r,{minimumValue:"0",maximumValue:"5",value:""+this.state.heightOptions.groundLevel,onChange:this.handleGroundLevel})),i.createElement("dt",null,"Flatten:"),i.createElement("dd",null,i.createElement(r,{minimumValue:"1",maximumValue:"40",value:""+this.state.heightOptions.flatten,onChange:this.handleFlatten})),i.createElement("dt",null,"Noise:"),i.createElement("dd",null,i.createElement(r,{minimumValue:"0",maximumValue:"50",value:""+~~(10*this.state.heightOptions.randomize),onChange:this.handleNoise}),i.createElement("br",null),i.createElement("label",null,i.createElement("input",{type:"checkbox",checked:this.state.heightOptions.noiseOnWater,onChange:this.handleNoiseOnWater})," Use also on unplayable areas? (water, lava, etc.)")),i.createElement("dt",null,"Default playable area terrain:"),i.createElement("dd",null,i.createElement(s,{terrain:this.state.textureOptions.terrain,texture:this.state.textureOptions.texture,textures:[14,0,8,9,10,15,18,34,6],onChange:this.handlePlayableTexture})),i.createElement("dt",null,"Default unplayable area terrain:"),i.createElement("dd",null,i.createElement(s,{terrain:this.state.textureOptions.terrain,texture:this.state.textureOptions.waterTexture,textures:[5,2,3,4,16,7,17,19,20,21,22],onChange:this.handleUnPlayableTexture}))),i.createElement("p",null,i.createElement("button",{onClick:this.handleResources},"Randomize Resources"))),i.createElement("section",null,i.createElement("header",null,"Player Options"),i.createElement("dl",null,i.createElement("dt",null,"Maximum number of players:"),i.createElement("dd",null,["None","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten"].map(function(t,e){return i.createElement("label",null,i.createElement("input",{name:"max-players",type:"radio",value:e,checked:this.state.maxPlayers===e,onChange:this.handleMaxPlayerChange})," ",t)}.bind(this))),i.createElement("dt",null,"Minimum player distance:"),i.createElement("dd",null,i.createElement(r,{minimumValue:"15",maximumValue:"150",value:""+this.state.playerMinDistance,onChange:this.handlePlayerMinDistance}))),i.createElement("p",null,i.createElement("button",{onClick:this.handlePlayers},"Randomize Players"))),i.createElement("dl",{className:"generator-statistics"},i.createElement("dt",null,"Players:"),i.createElement("dd",null,this.state.players.length),i.createElement("dt",null,"Trees:"),i.createElement("dd",null,this.state.resources.tree||0),i.createElement("dt",null,"Granite:"),i.createElement("dd",null,this.state.resources.granite||0),i.createElement("dt",null,"Coal:"),i.createElement("dd",null,Math.round(e/o*100,1)," %"),i.createElement("dt",null,"Iron ore:"),i.createElement("dd",null,Math.round(n/o*100,1)," %"),i.createElement("dt",null,"Gold:"),i.createElement("dd",null,Math.round(t/o*100,1)," %"),i.createElement("dt",null,"Granite:"),i.createElement("dd",null,Math.round(a/o*100,1)," %"),i.createElement("dt",null,"Land areas:"),i.createElement("dd",null,c.land),i.createElement("dt",null,"Water areas:"),i.createElement("dd",null,c.water)))}});window.onload=function(){i.render(i.createElement(h,null),document.getElementById("app"))}},function(t,e,n){"use strict";var a=n(13),i=n(12),o=n(4),r=o.CP437,s=o.COLOR,l=o.RESOURCE,u=o.SITE,h=o.TERRAIN,E=o.TEXTURE,c=o.TEXTURE_INFO,f=o.TREE_INFO,p=function(){function t(t,e,n){A=o.getNodesByIndex(t),y[t]=e,null!=n&&(delete U[n],L.push(n)),b++,Object.keys(A).forEach(function(e){t=A[e],0===y[t]&&(y[t]=1,L.length?U[L.pop()]=t:U.push(t))})}function e(t){var e,n,a="";for(n=0;n<t.length;n++)e=r.indexOf(~~t.charCodeAt(n)),a+=e>-1?t[n]:String.fromCharCode(r[219]);return a}function n(t,e){var n,a,i=[];for(a=0;e>a;a++)n=r.indexOf(~~t.charCodeAt(a)),n>-1?i.push(n):i.push(219);return i}var o,p,d,A,m,R,T,g,L,M,b,O,U,I,y,x,P,D,v,S=[],N=[],_=function(e){var n,a,r,s,l=e.likelyhood,u=~~e.startingPoints,h=~~e.massRatio;for(v=~~e.width,M=~~e.height,I=v*M,R=~~e.borderProtection,R&&(R=~~(Math.min(v,M)/R)),y=new Uint8Array(I),1>u?u=1:u>512&&(u=512),u>I>>2&&(u=I>>2),1>h?h=1:h>99&&(h=99),U=[],L=[],b=0,O=~~(I/100*h),x=0,o=new i(v,M),g=o.getRawData(),a=255;u>x;)r=~~(Math.random()*(v-2*R))+R,s=~~(Math.random()*(M-2*R))+R,n=s*v+r,0===y[n]&&(t(n,a),x++);var E,c=7;if(b>0)for(;O>b;){for(a--,E=U.length;E>0;--E)n=U[E],null!=n&&(P=0,d=o.getNodesByIndex(n),P+=(y[d.left]>1)+(y[d.right]>1)+(y[d.topLeft]>1)+(y[d.topRight]>1)+(y[d.bottomLeft]>1)+(y[d.bottomRight]>1),Math.random()<=l[P]&&(c>0?t(n,~~(a/c*P)+2,E):t(n,~~(a*(1+-c/20)*P)+2,E)));2===a&&(c--,a=3)}},G=function(t){m=t.baseLevel=~~t.baseLevel,t.groundLevel=Math.abs(~~t.groundLevel),t.flatten=Math.abs(t.flatten),t.noiseOnWater=!!t.noiseOnWater,t.groundLevel>5&&(t.groundLevel=5),t.flatten<1?t.flatten=1:t.flatten>100&&(t.flatten=100),o.initializeHeight(t.baseLevel);
var e,n,a=t.baseLevel<=30?t.groundLevel:-t.groundLevel,i=0;for(n=0;M>n;n++)for(e=0;v>e;e++)y[i]>1&&o.changeHeight(e,n,0,a),i++;var r,s,l;for(i=0,n=0;M>n;n++)for(e=0;v>e;e++){if(l=y[i],l>1){for(d=o.getRadiusNodes(e,n,5),s=r=a=0;a<d.length&&y[d[a]]>1;a++)s+=y[d[a]],r++;a>d.length-6&&(a=Math.round(s/r),o.changeHeight(e,n,Math.min((l-a)/t.flatten,1),l-a>0?(l&a&81)+1:-(l&a&3)-1))}i++}if(t.randomize>0)if(t.noiseOnWater)for(i=0,n=0;M>n;n++)for(e=0;v>e;e++)o.changeHeight(e,n,0,~~(Math.random()*(2*t.randomize+1)-t.randomize)),i++;else for(i=0,n=0;M>n;n++)for(e=0;v>e;e++)(y[i]>1||g[i]!==m)&&o.changeHeight(e,n,0,~~(Math.random()*(2*t.randomize+1)-t.randomize)),i++;o.calculateLightMap()},w=function(t){var e,n,a,i=new Uint32Array(60),r=60,s=0,l=[1,11,12,13],u=1*I,h=2*I,c=8*I;for(t.mountainGenerate=~~t.mountainGenerate,t.seamless=!!~~t.seamless,t.texture=~~t.texture&E.TO_ID_VALUE,t.waterTexture=~~t.waterTexture&E.TO_ID_VALUE,o.initializeTexture(t.texture),e=0;I>e;e++)i[g[e]]++,r>g[e]&&(r=g[e]),s<g[e]&&(s=g[e]);for(e=0;I>e;e++)n=3&y[e],g[e]>=m-2&&g[e]<=m+2&&(y[e]<2?o.setTexture(e,t.waterTexture):n>1?o.setTexture(e,7+(3&y[e])):0===n&&o.setTexture(e,15));if(o.initializeObjects(),o.calculateSiteMap(),7===t.mountainGenerate)for(e=0;I>e;e++)o.isAnyTextureWithAnyOfFlags(e,E.ARID|E.IMPASSABLE)||(a=o.getNodesByIndex(e),1===(247&g[c+a.left])&&1===(247&g[c+a.right])&&1===(247&g[c+a.topLeft])&&1===(247&g[c+a.topRight])&&1===(247&g[c+a.bottomLeft])&&1===(247&g[c+a.bottomRight])&&o.setTexture(e,l[~~(4*Math.random())]));else if(6===t.mountainGenerate)for(e=0;I>e;e++)1!==(247&g[c+e])||o.isAnyTextureWithAnyOfFlags(e,E.ARID|E.IMPASSABLE)||(a=o.getNodesByIndex(e),1===(247&g[c+a.left])&&1===(247&g[c+a.right])&&1===(247&g[c+a.topLeft])&&1===(247&g[c+a.topRight])&&1===(247&g[c+a.bottomLeft])&&1===(247&g[c+a.bottomRight])&&o.setTexture(e,l[~~(4*Math.random())]));else for(e=0;I>e;e++)1!==(247&g[c+e])||o.isAnyTextureWithAnyOfFlags(e,E.ARID|E.IMPASSABLE)||(a=o.getNodesByIndex(e),t.mountainGenerate<=(1===(247&g[c+a.left]))+(1===(247&g[c+a.right]))+(1===(247&g[c+a.topLeft]))+(1===(247&g[c+a.topRight]))+(1===(247&g[c+a.bottomLeft]))+(1===(247&g[c+a.bottomRight]))&&o.setTexture(e,l[~~(4*Math.random())]));if(!t.seamless){for(e=0;v>e;e++)switch(g[u+e]){case 0:case 14:o.setTexture(e,3);break;case 8:case 9:case 10:case 15:o.setTexture(e,3);break;case 4:case 7:o.setTexture(e,2);break;case 17:o.setTexture(e,16);break;case 18:case 34:o.setTexture(e,16);break;case 1:case 11:case 12:case 13:o.setTexture(e,2);break;case 5:case 6:o.setTexture(e,19);break;default:switch(g[h+e]){case 0:case 14:o.setTexture(e,3);break;case 8:case 9:case 10:case 15:o.setTexture(e,3);break;case 4:case 7:o.setTexture(e,2);break;case 17:o.setTexture(e,16);break;case 18:case 34:o.setTexture(e,16);break;case 1:case 11:case 12:case 13:o.setTexture(e,2);break;case 5:case 6:o.setTexture(e,19)}}for(;I>e;e+=v)switch(g[u+e]){case 0:case 14:o.setTexture(e,3);break;case 8:case 9:case 10:case 15:o.setTexture(e,3);break;case 4:case 7:o.setTexture(e,2);break;case 17:o.setTexture(e,16);break;case 18:case 34:o.setTexture(e,16);break;case 1:case 11:case 12:case 13:o.setTexture(e,2);break;case 5:case 6:o.setTexture(e,19);break;default:switch(g[h+e]){case 0:case 14:o.setTexture(e,3);break;case 8:case 9:case 10:case 15:o.setTexture(e,3);break;case 4:case 7:o.setTexture(e,2);break;case 17:o.setTexture(e,16);break;case 18:case 34:o.setTexture(e,16);break;case 1:case 11:case 12:case 13:o.setTexture(e,2);break;case 5:case 6:o.setTexture(e,19)}}}for(e=0;I>e;e++)o.isAnyTextureWithAnyOfFlags(e,E.ROCK)?o.replaceTextureAnyOfFlags(e,18,E.ARABLE):o.isMixedTextureWithAllOfFlags(e,E.WATER|E.HABITABLE)?Math.random()<.5&&o.replaceTextureAnyOfFlags(e,4,E.WATER|E.HABITABLE):o.isMixedTextureWithAllOfFlags(e,E.WATER|E.ROCK)?o.replaceTextureAnyOfFlags(e,18,E.WATER|E.ARID):o.isMixedTextureWithAllOfFlags(e,E.WATER|E.MOUNT_MEADOW)&&o.replaceTextureAnyOfFlags(e,18,E.WATER|E.ARID|E.HABITABLE);for(e=0;I>e;e++)o.isMixedTextureWithAllOfFlags(e,E.ARID|E.ARABLE)&&Math.random()<.75&&o.replaceTextureAnyOfFlags(e,14,E.ARABLE);for(e=0;I>e;e++)o.isMixedTextureWithAllOfFlags(e,E.STEPPE|E.ARABLE)?Math.random()<.75&&o.replaceTextureAnyOfFlags(e,0,E.MEADOW):o.isMixedTextureWithAllOfFlags(e,E.WATER|E.ARID)?Math.random()<.15&&o.setTexture(e,14):o.isMixedTextureWithAllOfFlags(e,E.STEPPE|E.ARID)?Math.random()<.5&&o.setTexture(e,14):o.isEachTextureSame(e,3)&&Math.random()<.05&&o.setTexture(e,19);o.calculateSiteMap(),p=o.calculateAreaMap()},H=function(){return p},C=function(t,e){function n(a){var i;if(a.length>0&&N.length<t){var r=a[~~(Math.random()*a.length)],s=r%v,l=~~((r-s)/v);i=Array.apply([],o.getRadiusNodes(s,l,e)),a=a.filter(function(t){return-1===i.indexOf(t)}),N.push({index:r,x:s,y:l}),n(a,e)}}return N=[],t=~~t,0>t?t=0:t>10&&(t=10),e=~~e,t>0&&n(o.getAllSitesOfType(u.CASTLE)),N},F=function(t){var e,n,a,i,r,s,h,f,p,d=0,A={freshWater:0,mineCoal:0,mineIronOre:0,mineGold:0,mineGranite:0,fish:0,granite:0,tree:0},m=4*I,R=5*I,T=8*I,L=10*I,M=11*I;for(e=0;I>e;e++)g[m+e]=0,g[R+e]=0;for(t=t||{},t.treeRatio=null!=t.treeRatio?~~t.treeRatio:33,t.treeRatio<0?t.treeRatio=0:t.treeRatio>50?t.treeRatio=.5:t.treeRatio/=100,t.graniteRatio=null!=t.graniteRatio?~~t.graniteRatio:15,t.graniteRatio<0?t.graniteRatio=0:t.graniteRatio>25?t.graniteRatio=.25:t.graniteRatio/=100,e=0;I>e;e++)s=0,p=o.getTexturesByIndex(e),f=c[p.topLeft].FLAG&E.DROP_SUPPORT,r=f===(c[p.top].FLAG&E.DROP_SUPPORT)&&f===(c[p.topRight].FLAG&E.DROP_SUPPORT)&&f===(c[p.bottomLeft].FLAG&E.DROP_SUPPORT)&&f===(c[p.bottom].FLAG&E.DROP_SUPPORT)&&f===(c[p.bottomRight].FLAG&E.DROP_SUPPORT),r&&(5===p.topLeft?(h=o.getNodesByIndex(e),(g[T+h.left]!==u.IMPASSABLE||g[T+h.right]!==u.IMPASSABLE||g[T+h.topLeft]!==u.IMPASSABLE||g[T+h.topRight]!==u.IMPASSABLE||g[T+h.bottomLeft]!==u.IMPASSABLE||g[T+h.bottomRight]!==u.IMPASSABLE)&&(s=l.FISH,A.fish++)):f&E.ROCK?(s=63&y[e],44>s?(s=l.COAL|7&e,A.mineCoal+=7&e):48>s?(s=l.GOLD|7&e,A.mineGold+=7&e):62>s?(s=l.IRON_ORE|7&e,A.mineIronOre+=7&e):(s=l.GRANITE|7&e,A.mineGranite+=7&e)):f&E.HABITABLE&&f&E.ARABLE&&(s=l.FRESH_WATER,A.freshWater++)),g[M+e]=s,g[T+e]===u.IMPASSABLE?g[L+e]=1:d++;for(e=0;e<N.length;e++){for(h=o.getRadiusNodes(N[e].x,N[e].y,5),n=0;n<h.length;n++)g[L+h[n]]=1;d-=n}for(t.treeRatio*=d;d>0&&A.tree<t.treeRatio;)if(e=~~(Math.random()*I),0===g[L+e])for(h=o.getRadiusNodes(e%v,~~((e-e%v)/v),7&y[e]),n=0;n<h.length;n++)a=h[n],0===g[L+a]&&((3&y[a])<2||Math.random()<.2)&&(g[L+a]=1,i=~~(6*Math.random()),i>2&&(i+=3),g[R+a]=196|i>>2,g[m+a]=48|64*(3&i)|~~(8*Math.random()),A.tree++,d--);for(t.graniteRatio*=d;d>0&&A.granite<t.graniteRatio;)if(e=~~(Math.random()*I),0===g[L+e])for(h=o.getRadiusNodes(e%v,~~((e-e%v)/v),7&y[e]),n=0;n<h.length;n++)a=h[n],0===g[L+a]&&((3&y[a])<2||Math.random()<.2)&&(g[L+a]=1,g[R+a]=204|1&y[a],g[m+a]=~~(5*Math.random())+2,A.granite++,d--);for(e=0;I>e;e++)g[L+e]=0;return o.calculateSiteMap(),A},B=function(t){var e=t.canvas,n=e.getContext("2d"),a=n.getImageData(0,0,v,M),i=a.data,r=12*I;e.width=v,e.height=M,D=t.viewType,t.terrain=~~t.terrain||h.GREENLAND;var l,u,E;switch(D){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:for(l=I*D,u=0,E=l+I;E>l;l++)i[u++]=g[l],i[u++]=g[l],i[u++]=g[l],i[u++]=255;break;case"seed":for(l=0,u=0;I>l;l++)i[u++]=255-y[l],i[u++]=255-y[l],i[u++]=255-y[l],i[u++]=255;U.forEach(function(t){i[t<<2]=96,i[(t<<2)+1]=176,i[(t<<2)+2]=255});break;case"fast":!function(){var e,n,a,o,u,h,E=S[t.terrain].data,c=-1,f=s.ORIGINAL[t.terrain],p=I,d=4*I,A=5*I,m=0;for(l=0;I>l;l++){switch(l%v===0&&c++,o=null,g[A+l]){case 196:case 197:case 198:case 199:switch(e=(2&g[A+l])<<2|(192&g[d+l])>>6,e%6+6*t.terrain){case 0:o=0,u=73,h=18;break;case 1:o=6,u=93,h=15;break;case 2:o=0,u=51,h=19;break;case 6:o=69,u=59,h=18;break;case 7:o=69,u=67,h=42;break;case 8:o=0,u=51,h=19;break;case 12:o=25,u=64,h=0;break;case 13:o=41,u=86,h=0;break;case 14:o=14,u=41,h=0}break;case 204:case 205:}null==o&&(n=~~(g[r+l]/128*255),a=4*(n+256*f[63&g[p+l]]),o=E[a++],u=E[a++],h=E[a++]),i[m++]=o,i[m++]=u,i[m++]=h,i[m++]=255}}();break;case"pretty":!function(){var e,n,a,r,h,E,c,p,d,A,m,R,T,L,M,b,O,U,y,x,P,D,N=S[t.terrain].data,_=-1,G=s.MERRI[t.terrain],w=s.ORIGINAL[t.terrain],H=4*I,C=5*I,F=0;for(l=0;I>l;l++){switch(l%v===0&&_++,x=o.getNodesByIndex(l),P=o.getNodesByIndex(x.left),u=g[l],n=96,n+=12*(g[x.topRight]-u),n+=8*(g[x.topLeft]-u),n-=8*(g[x.left]-u),n-=16*(g[P.bottomLeft]-u),n=Math.max(Math.min(255,n),0),D=o.getTexturesByIndex(l),r=4*(n+256*G[D.topLeft]),h=4*(n+256*w[D.topLeft]),E=4*(n+256*G[D.top]),c=4*(n+256*w[D.top]),p=4*(n+256*G[D.topRight]),d=4*(n+256*w[D.topRight]),A=4*(n+256*G[D.bottomLeft]),m=4*(n+256*w[D.bottomLeft]),R=4*(n+256*G[D.bottom]),T=4*(n+256*w[D.bottom]),L=4*(n+256*G[D.bottomRight]),M=4*(n+256*w[D.bottomRight]),b=(N[r++]+N[h++]+N[E++]+N[c++]+N[p++]+N[d++]+N[A++]+N[m++]+N[R++]+N[T++]+N[L++]+N[M++])/12|0,O=(N[r++]+N[h++]+N[E++]+N[c++]+N[p++]+N[d++]+N[A++]+N[m++]+N[R++]+N[T++]+N[L++]+N[M++])/12|0,U=(N[r++]+N[h++]+N[E++]+N[c++]+N[p++]+N[d++]+N[A++]+N[m++]+N[R++]+N[T++]+N[L++]+N[M++])/12|0,y=255-30*((5===D.topLeft)+(5===D.top)+(5===D.topRight)+(5===D.bottomLeft)+(5===D.bottom)+(5===D.bottomRight)),g[C+l]){case 196:case 197:case 198:case 199:e=(2&g[C+l])<<2|(192&g[H+l])>>6,n=f[t.terrain][e].ALPHA+((7&g[H+l])+1)/25-.32,a=1-n,b=~~(b*a+f[t.terrain][e].RED*n),O=~~(O*a+f[t.terrain][e].GREEN*n),U=~~(U*a+f[t.terrain][e].BLUE*n);break;case 204:case 205:n=g[H+l]/10,a=((b+O+U)/3+64)*n,b=Math.min(255,b*(1-n)+a),O=Math.min(255,O*(1-n)+a),U=Math.min(255,U*(1-n)+a)}i[F++]=b,i[F++]=O,i[F++]=U,i[F++]=y}}();break;default:throw new Error("Unknown viewType option "+t.viewType)}n.putImageData(a,0,0)},W=function(t){var e,a,i=new ArrayBuffer(2577+14*I),o=new DataView(i),r=0,s=4*I,l=5*I;for(t=t||{},t.title=t.title||"Unknown map",t.author=t.author||"Merri'sMapGenerator",t.terrain=~~t.terrain||h.GREENLAND,o.setUint8(r++,87),o.setUint8(r++,79),o.setUint8(r++,82),o.setUint8(r++,76),o.setUint8(r++,68),o.setUint8(r++,95),o.setUint8(r++,86),o.setUint8(r++,49),o.setUint8(r++,46),o.setUint8(r++,48),n(t.title,19).forEach(function(t){o.setUint8(r++,t)}),o.setUint8(r++,0),o.setUint16(r++,v,!0),r++,o.setUint16(r++,M,!0),r++,o.setUint8(r++,t.terrain),o.setUint8(r++,N.length),n(t.author,19).forEach(function(t){o.setUint8(r++,t)}),o.setUint8(r++,0),N.length>0?(o.setUint16(r,N[0].x,!0),o.setUint16(r+14,N[0].y,!0)):(o.setUint16(r,65535,!0),o.setUint16(r+14,65535,!0)),N.length>1?(o.setUint16(r+2,N[1].x,!0),o.setUint16(r+16,N[1].y,!0)):(o.setUint16(r+2,65535,!0),o.setUint16(r+16,65535,!0)),N.length>2?(o.setUint16(r+4,N[2].x,!0),o.setUint16(r+18,N[2].y,!0)):(o.setUint16(r+4,65535,!0),o.setUint16(r+18,65535,!0)),N.length>3?(o.setUint16(r+6,N[3].x,!0),o.setUint16(r+20,N[3].y,!0)):(o.setUint16(r+6,65535,!0),o.setUint16(r+20,65535,!0)),N.length>4?(o.setUint16(r+8,N[4].x,!0),o.setUint16(r+22,N[4].y,!0)):(o.setUint16(r+8,65535,!0),o.setUint16(r+22,65535,!0)),N.length>5?(o.setUint16(r+10,N[5].x,!0),o.setUint16(r+24,N[5].y,!0)):(o.setUint16(r+10,65535,!0),o.setUint16(r+24,65535,!0)),N.length>6?(o.setUint16(r+12,N[6].x,!0),o.setUint16(r+26,N[6].y,!0)):(o.setUint16(r+12,65535,!0),o.setUint16(r+26,65535,!0)),r+=28,a=0;a<N.length;a++)g[s+N[a].index]=a,g[l+N[a].index]=128;for(o.setUint8(r++,0,!0),o.setUint8(r++,0),o.setUint8(r++,3),o.setUint8(r++,6),o.setUint8(r++,9),o.setUint8(r++,1),o.setUint8(r++,4),o.setUint8(r++,7),a=0;a<Math.min(p.length,250);a++)o.setUint8(r++,p[a].type),o.setUint16(r++,p[a].x,!0),r++,o.setUint16(r++,p[a].y,!0),r++,o.setUint32(r,p[a].mass,!0),r+=4;for(r+=9*(250-a),o.setUint8(r++,17),o.setUint8(r++,39),o.setUint32(r,0,!0),r+=4,o.setUint16(r++,v,!0),r++,o.setUint16(r++,M,!0),r++,a=0;14>a;a++)o.setUint8(r++,16),o.setUint8(r++,39),o.setUint32(r,0),r+=4,o.setUint16(r++,v,!0),r++,o.setUint16(r++,M,!0),r++,o.setUint16(r++,1,!0),r++,o.setUint32(r,I,!0),r+=4,e=new Uint8Array(i,r,I),r+=I,e.set(g.subarray(a*I,(a+1)*I));for(o.setUint8(r++,255),a=0;a<N.length;a++)g[s+N[a].index]=0,g[l+N[a].index]=0;return new Blob([new Uint8Array(i)],{type:"application/octet-binary"})},k=function(){return T},V=function(t){return new a(function(e,n){switch(T=document.createElement("img"),T.onload=function(t){var a,i=document.createElement("canvas");try{i.width=256,i.height=768,a=i.getContext("2d"),a.drawImage(t.target,0,0),S[0]=a.getImageData(0,0,256,256),S[1]=a.getImageData(0,256,256,256),S[2]=a.getImageData(0,512,256,256),T=!0,e(S)}catch(o){T=!1,n(o)}},T.onerror=n,t){case"alternative":T.src="./lightmap_index_alternative.png";break;case"high-contrast":T.src="./lightmap_index_high-contrast.png";break;default:T.src="./lightmap_index.png"}})};return{applyResources:F,createBaseTextures:w,createHeight:G,draw:B,getAreas:H,getFileBlob:W,getRandomPlayerPositions:C,isReadyToDraw:k,seed:_,setColorMap:V,sanitizeStringAsCP437:e}};t.exports=p},function(t,e,n){"use strict";var a=n(4),i=a.AREA,o=a.OBJECT_TYPE,r=a.SITE,s=a.TEXTURE,l=a.TEXTURE_INFO,u=5,h=60,E=1,c=2,f=4,p=8,d=16,A=32,m=64,R=s.EXTREME|s.WET,T=function(t,e){function n(){var t,e,n,a,o,r,s=0,l=[];for(t=0;Y>t;t++)if(0===j[it+t])if(250>s&&S(t,5)){for(j[rt+t]=s,j[it+t]=1,o=1,q[n=r=0]=t<<6|63;r>=n;)e=63&q[n],a=b((4294967232&q[n++])>>6),1===(1&e)&&0===j[it+a.left]&&S(a.left,5)&&(q[++r]=a.left<<6|35,j[rt+a.left]=s,j[it+a.left]=1,o++),2===(2&e)&&0===j[it+a.topLeft]&&S(a.topLeft,5)&&(q[++r]=a.topLeft<<6|7,j[rt+a.topLeft]=s,j[it+a.topLeft]=1,o++),4===(4&e)&&0===j[it+a.topRight]&&S(a.topRight,5)&&(q[++r]=a.topRight<<6|14,j[rt+a.topRight]=s,j[it+a.topRight]=1,o++),8===(8&e)&&0===j[it+a.right]&&S(a.right,5)&&(q[++r]=a.right<<6|28,j[rt+a.right]=s,j[it+a.right]=1,o++),16===(16&e)&&0===j[it+a.bottomRight]&&S(a.bottomRight,5)&&(q[++r]=a.bottomRight<<6|56,j[rt+a.bottomRight]=s,j[it+a.bottomRight]=1,o++),32===(32&e)&&0===j[it+a.bottomLeft]&&S(a.bottomLeft,5)&&(q[++r]=a.bottomLeft<<6|49,j[rt+a.bottomLeft]=s,j[it+a.bottomLeft]=1,o++);l[s]={mass:o,type:i.WATER,x:t%X,y:~~((t-t%X)/X)},s++}else if(N(t,R))j[rt+t]=i.IMPASSABLE,j[it+t]=1;else if(250>s){for(j[rt+t]=s,j[it+t]=1,o=1,q[n=r=0]=t<<6|63;r>=n;)e=63&q[n],a=b((4294967232&q[n++])>>6),1!==(1&e)||0!==j[it+a.left]||N(a.left,R)||(q[++r]=a.left<<6|35,j[rt+a.left]=s,j[it+a.left]=1,o++),2!==(2&e)||0!==j[it+a.topLeft]||N(a.topLeft,R)||(q[++r]=a.topLeft<<6|7,j[rt+a.topLeft]=s,j[it+a.topLeft]=1,o++),4!==(4&e)||0!==j[it+a.topRight]||N(a.topRight,R)||(q[++r]=a.topRight<<6|14,j[rt+a.topRight]=s,j[it+a.topRight]=1,o++),8!==(8&e)||0!==j[it+a.right]||N(a.right,R)||(q[++r]=a.right<<6|28,j[rt+a.right]=s,j[it+a.right]=1,o++),16!==(16&e)||0!==j[it+a.bottomRight]||N(a.bottomRight,R)||(q[++r]=a.bottomRight<<6|56,j[rt+a.bottomRight]=s,j[it+a.bottomRight]=1,o++),32!==(32&e)||0!==j[it+a.bottomLeft]||N(a.bottomLeft,R)||(q[++r]=a.bottomLeft<<6|49,j[rt+a.bottomLeft]=s,j[it+a.bottomLeft]=1,o++);l[s]={mass:o,type:i.LAND,x:t%X,y:~~((t-t%X)/X)},s++}else l[s]={mass:0,type:i.UNUSED,x:t%X,y:~~((t-t%X)/X)},s++;for(t=0;Y>t;t++)j[it+t]=0;return l}function a(){var t,e,n,a,i;for(n=0;Y>n;n++)a=64,i=j[Q+n],t=b(n),e=b(t.left),a+=9*(j[Q+t.topRight]-i),a-=6*(j[Q+t.left]-i),a-=3*(j[Q+e.left]-i),a-=9*(j[Q+e.bottomLeft]-i),j[ot+n]=Math.max(Math.min(128,a),0)}function T(){var t,e,n,a,i,u,h,E,c,f,p,d,A,m,R=0,T=0;for(t=0;Y>t;t++)e=b(t),m=I(t),a=j[Z+m.topLeft]&s.TO_ID_VALUE,i=j[Z+m.top]&s.TO_ID_VALUE,u=j[Z+m.topRight]&s.TO_ID_VALUE,h=j[Z+m.bottomLeft]&s.TO_ID_VALUE,E=j[Z+m.bottom]&s.TO_ID_VALUE,c=j[Z+m.bottomRight]&s.TO_ID_VALUE,m=I(e.bottomRight),f=j[Z+m.topRight]&s.TO_ID_VALUE,p=j[Z+m.bottomLeft]&s.TO_ID_VALUE,d=j[Z+m.bottom]&s.TO_ID_VALUE,A=j[Z+m.bottomRight]&s.TO_ID_VALUE,(l[a].FLAG&s.EXTREME)===s.EXTREME||(l[i].FLAG&s.EXTREME)===s.EXTREME||(l[u].FLAG&s.EXTREME)===s.EXTREME||(l[h].FLAG&s.EXTREME)===s.EXTREME||(l[E].FLAG&s.EXTREME)===s.EXTREME||(l[c].FLAG&s.EXTREME)===s.EXTREME||6===(T=((l[a].FLAG&s.WET)===s.WET)+((l[i].FLAG&s.WET)===s.WET)+((l[u].FLAG&s.WET)===s.WET)+((l[h].FLAG&s.WET)===s.WET)+((l[E].FLAG&s.WET)===s.WET)+((l[c].FLAG&s.WET)===s.WET))||(j[et+t]&o.MATCH)===o.GRANITE?j[nt+t]=r.IMPASSABLE:(j[et+t]&o.MATCH)===o.TREE?j[nt+t]=r.TREE:T>0||(j[et+e.left]&o.MATCH)===o.GRANITE||(j[et+e.right]&o.MATCH)===o.GRANITE||(j[et+e.topLeft]&o.MATCH)===o.GRANITE||(j[et+e.topRight]&o.MATCH)===o.GRANITE||(j[et+e.bottomLeft]&o.MATCH)===o.GRANITE||(j[et+e.bottomRight]&o.MATCH)===o.GRANITE||(l[a].FLAG&s.ARID)===s.ARID||(l[i].FLAG&s.ARID)===s.ARID||(l[u].FLAG&s.ARID)===s.ARID||(l[h].FLAG&s.ARID)===s.ARID||(l[E].FLAG&s.ARID)===s.ARID||(l[c].FLAG&s.ARID)===s.ARID?j[nt+t]=r.FLAG_OCCUPIED:6===(R=((l[a].FLAG&s.ROCK)===s.ROCK)+((l[i].FLAG&s.ROCK)===s.ROCK)+((l[u].FLAG&s.ROCK)===s.ROCK)+((l[h].FLAG&s.ROCK)===s.ROCK)+((l[E].FLAG&s.ROCK)===s.ROCK)+((l[c].FLAG&s.ROCK)===s.ROCK))&&j[t]-j[e.bottomRight]>=-3?(l[f].FLAG&s.EXTREME)===s.EXTREME||(l[p].FLAG&s.EXTREME)===s.EXTREME||(l[d].FLAG&s.EXTREME)===s.EXTREME||(l[A].FLAG&s.EXTREME)===s.EXTREME||(j[et+e.bottomRight]&o.MATCH)===o.TREE?j[nt+t]=r.FLAG_OCCUPIED:j[nt+t]=r.MINE_OCCUPIED:R>0?j[nt+t]=r.FLAG_OCCUPIED:(j[et+e.bottomRight]&o.MATCH)===o.TREE||j[t]-j[e.bottomRight]>3||j[e.bottomRight]-j[t]>1||Math.abs(j[t]-j[e.topLeft])>3||Math.abs(j[t]-j[e.topRight])>3||Math.abs(j[t]-j[e.left])>3||Math.abs(j[t]-j[e.right])>3||Math.abs(j[t]-j[e.bottomLeft])>3?18===a||18===i||18===u||18===h||18===E||18===c?j[nt+t]=r.FLAG_OCCUPIED:j[nt+t]=r.FLAG:(l[f].FLAG&s.EXTREME)===s.EXTREME||(l[p].FLAG&s.EXTREME)===s.EXTREME||(l[d].FLAG&s.EXTREME)===s.EXTREME||(l[A].FLAG&s.EXTREME)===s.EXTREME?j[nt+t]=r.FLAG_OCCUPIED:(j[et+e.topLeft]&o.MATCH)===o.TREE||(j[et+e.topRight]&o.MATCH)===o.TREE||(j[et+e.left]&o.MATCH)===o.TREE||(j[et+e.right]&o.MATCH)===o.TREE||(j[et+e.bottomLeft]&o.MATCH)===o.TREE||!(n=O(t%X,~~((t-t%X)/X),2,!0))||Math.abs(j[t]-j[n[0]])>2||Math.abs(j[t]-j[n[1]])>2||Math.abs(j[t]-j[n[2]])>2||Math.abs(j[t]-j[n[3]])>2||Math.abs(j[t]-j[n[4]])>2||Math.abs(j[t]-j[n[5]])>2||Math.abs(j[t]-j[n[6]])>2||Math.abs(j[t]-j[n[7]])>2||Math.abs(j[t]-j[n[8]])>2||Math.abs(j[t]-j[n[9]])>2||Math.abs(j[t]-j[n[10]])>2||Math.abs(j[t]-j[n[11]])>2?18===a||18===i||18===u||18===h||18===E||18===c?j[nt+t]=r.HUT_OCCUPIED:j[nt+t]=r.HUT:18===a||18===i||18===u||18===h||18===E||18===c?j[nt+t]=r.CASTLE_OCCUPIED:j[nt+t]=r.CASTLE}function g(t,e,n,a){var i,o,r,s,l,R,T,g,L,M,U=[];if(a=~~a,n=Math.abs(~~n),0>a){for(-u>a&&(a=-u),o=O(t,e,n),l=0;l<o.length;l++)g=o[l],i=j[g]+a,0>i&&(i=0),j[g]!==i&&(j[g]=i,L=b(g),0===j[it+g]&&U.push(g),0===j[it+L.left]&&U.push(L.left),0===j[it+L.right]&&U.push(L.right),0===j[it+L.topLeft]&&U.push(L.topLeft),0===j[it+L.topRight]&&U.push(L.topRight),0===j[it+L.bottomLeft]&&U.push(L.bottomLeft),0===j[it+L.bottomRight]&&U.push(L.bottomRight),j[it+g]|=E,j[it+L.left]|=c,j[it+L.right]|=f,j[it+L.topLeft]|=p,j[it+L.bottomRight]|=d,j[it+L.topRight]|=A,j[it+L.bottomLeft]|=m);M=o.length}else if(a>0){for(a>u&&(a=u),o=O(t,e,n),l=0;l<o.length;l++)g=o[l],i=j[g]+a,i>h&&(i=h),j[g]!==i&&(j[g]=i,L=b(g),0===j[it+g]&&U.push(g),0===j[it+L.left]&&U.push(L.left),0===j[it+L.right]&&U.push(L.right),0===j[it+L.topLeft]&&U.push(L.topLeft),0===j[it+L.topRight]&&U.push(L.topRight),0===j[it+L.bottomLeft]&&U.push(L.bottomLeft),0===j[it+L.bottomRight]&&U.push(L.bottomRight),j[it+g]|=E,j[it+L.left]|=c,j[it+L.right]|=f,j[it+L.topLeft]|=p,j[it+L.bottomRight]|=d,j[it+L.topRight]|=A,j[it+L.bottomLeft]|=m);M=o.length}for(;U.length>M;)for(l=0;l<U.length;l++)g=U[l],R=j[it+g],0===(R&E)&&(j[it+g]|=E,M++,s=0,T=j[g],L=b(g),R&c&&(r=T-j[L.right],Math.abs(r)>u&&Math.abs(r)>Math.abs(s)&&(s=r)),R&f&&(r=T-j[L.left],Math.abs(r)>u&&Math.abs(r)>Math.abs(s)&&(s=r)),R&d&&(r=T-j[L.topLeft],Math.abs(r)>u&&Math.abs(r)>Math.abs(s)&&(s=r)),R&p&&(r=T-j[L.bottomRight],Math.abs(r)>u&&Math.abs(r)>Math.abs(s)&&(s=r)),R&m&&(r=T-j[L.topRight],Math.abs(r)>u&&Math.abs(r)>Math.abs(s)&&(s=r)),R&A&&(r=T-j[L.bottomLeft],Math.abs(r)>u&&Math.abs(r)>Math.abs(s)&&(s=r)),s&&(0>s?s+=u:s>0&&(s-=u),i=T-s,j[g]=i,0===(R&f)&&(0===j[it+L.left]&&U.push(L.left),j[it+L.left]|=c),0===(R&c)&&(0===j[it+L.right]&&U.push(L.right),j[it+L.right]|=f),0===(R&d)&&(0===j[it+L.topLeft]&&U.push(L.topLeft),j[it+L.topLeft]|=p),0===(R&p)&&(0===j[it+L.bottomRight]&&U.push(L.bottomRight),j[it+L.bottomRight]|=d),0===(R&m)&&(0===j[it+L.topRight]&&U.push(L.topRight),j[it+L.topRight]|=A),0===(R&A)&&(0===j[it+L.bottomLeft]&&U.push(L.bottomLeft),j[it+L.bottomLeft]|=m)));for(l=0;l<U.length;l++)j[it+U[l]]=0}function L(t,e){var n,a=255,i=[];for(e||0!==(240&t)||(a=15,t&=a),n=0;Y>n;n++)(j[nt+n]&a)===t&&i.push(n);return i}function M(t){return t=~~t,t>=0&&13>=t?j.subarray(t*Y,++t*Y):void 0}function b(t){var e=t%X,n=(t-e)/X,a=(e>0?e:X)-1,i=(e+1)%X,o=((n>0?n:K)-1)*X,r=(n+1)%K*X,s=1===(1&n);return n*=X,s?{left:n+a,right:n+i,topLeft:o+e,topRight:o+i,bottomLeft:r+e,bottomRight:r+i}:{left:n+a,right:n+i,topLeft:o+a,topRight:o+e,bottomLeft:r+a,bottomRight:r+e}}function O(t,e,n,a){var i,o,r,s,l,u,h,E,c,f=0,p=0===(1&e);if(n=Math.abs(~~n),a=!!a,0===n)J[n]||(J[n]=new Uint32Array(1)),i=J[n],i[0]=e*X+t;else if(c=~~((Math.min(X,K)-2)/2),n>c&&(n=c),u=(X+t-n)%X,h=(t+n)%X,s=l=E=e*X,a){for($[n]||($[n]=new Uint32Array(6*n)),i=$[n],i[f++]=E+u,i[f++]=E+h,r=1;n>r;r++)p?h>0?h--:h=X-1:u=++u%X,p=!p,s=(Y+s-X)%Y,l=(l+X)%Y,i[f++]=s+u,i[f++]=s+h,i[f++]=l+u,i[f++]=l+h;if(p?h>0?h--:h=X-1:u=++u%X,s=(Y+s-X)%Y,l=(l+X)%Y,h>u)for(o=u;h>=o;o++)i[f++]=s+o,i[f++]=l+o;else{for(o=u;X>o;o++)i[f++]=s+o,i[f++]=l+o;for(o=0;h>=o;o++)i[f++]=s+o,i[f++]=l+o}}else{if(J[n]||(J[n]=new Uint32Array(1+6*(n*(n+1)>>1))),i=J[n],h>u)for(o=u;h>=o;o++)i[f++]=E+o;else{for(o=u;X>o;o++)i[f++]=E+o;for(o=0;h>=o;o++)i[f++]=E+o}for(r=1;n>=r;r++)if(p?h>0?h--:h=X-1:u=++u%X,p=!p,s=(Y+s-X)%Y,l=(l+X)%Y,h>u)for(o=u;h>=o;o++)i[f++]=s+o,i[f++]=l+o;else{for(o=u;X>o;o++)i[f++]=s+o,i[f++]=l+o;for(o=0;h>=o;o++)i[f++]=s+o,i[f++]=l+o}}return i}function U(){return j}function I(t){var e,n=t%X,a=(t-n)/X,i=(n>0?n:X)-1,o=((a>0?a:K)-1)*X,r=1===(1&a);return a*=X,r?(e=(n+1)%X,{bottomLeft:a+i+Y,bottom:t,bottomRight:t+Y,topLeft:o+n,top:o+n+Y,topRight:o+e}):{bottomLeft:a+i+Y,bottom:t,bottomRight:t+Y,topLeft:o+i,top:o+i+Y,topRight:o+n}}function y(t){var e=I(t);return{topLeft:j[Z+e.topLeft]&s.TO_ID_VALUE,top:j[Z+e.top]&s.TO_ID_VALUE,topRight:j[Z+e.topRight]&s.TO_ID_VALUE,bottomLeft:j[Z+e.bottomLeft]&s.TO_ID_VALUE,bottom:j[Z+e.bottom]&s.TO_ID_VALUE,bottomRight:j[Z+e.bottomRight]&s.TO_ID_VALUE}}function x(t){var e;for(t=~~t,0>t?t=0:t>h&&(t=h),e=0;Y>e;e++)j[Q+e]=t}function P(t){var e;if(t=Math.abs(~~t)&s.TO_ID_VALUE,l[t])for(e=0;2*Y>e;e++)j[Z+e]=t}function D(){var t;for(t=0;2*Y>t;t++)j[tt+t]=0}function v(t,e){var n,a,i,o,r,u,h;return H===t?(a=C,i=F,o=B,r=W,u=k,h=V):(n=I(t),H=t,C=a=j[Z+n.topLeft]&s.TO_ID_VALUE,F=i=j[Z+n.top]&s.TO_ID_VALUE,B=o=j[Z+n.topRight]&s.TO_ID_VALUE,W=r=j[Z+n.bottomLeft]&s.TO_ID_VALUE,k=u=j[Z+n.bottom]&s.TO_ID_VALUE,V=h=j[Z+n.bottomRight]&s.TO_ID_VALUE),!!(l[a].FLAG&e||l[i].FLAG&e||l[o].FLAG&e||l[r].FLAG&e||l[u].FLAG&e||l[h].FLAG&e)}function S(t,e){var n,a,i,o,r,l,u;return H===t?(a=C,i=F,o=B,r=W,l=k,u=V):(n=I(t),H=t,C=a=j[Z+n.topLeft]&s.TO_ID_VALUE,F=i=j[Z+n.top]&s.TO_ID_VALUE,B=o=j[Z+n.topRight]&s.TO_ID_VALUE,W=r=j[Z+n.bottomLeft]&s.TO_ID_VALUE,k=l=j[Z+n.bottom]&s.TO_ID_VALUE,V=u=j[Z+n.bottomRight]&s.TO_ID_VALUE),a===e&&i===e&&o===e&&r===e&&l===e&&u===e}function N(t,e){var n,a,i,o,r,u,h;return H===t?(a=C,i=F,o=B,r=W,u=k,h=V):(n=I(t),H=t,C=a=j[Z+n.topLeft]&s.TO_ID_VALUE,F=i=j[Z+n.top]&s.TO_ID_VALUE,B=o=j[Z+n.topRight]&s.TO_ID_VALUE,W=r=j[Z+n.bottomLeft]&s.TO_ID_VALUE,k=u=j[Z+n.bottom]&s.TO_ID_VALUE,V=h=j[Z+n.bottomRight]&s.TO_ID_VALUE),!!(l[a].FLAG&e&&l[i].FLAG&e&&l[o].FLAG&e&&l[r].FLAG&e&&l[u].FLAG&e&&l[h].FLAG&e)}function _(t,e){var n,a,i,o,r,u,h;return H===t?(a=C,i=F,o=B,r=W,u=k,h=V):(n=I(t),H=t,C=a=j[Z+n.topLeft]&s.TO_ID_VALUE,F=i=j[Z+n.top]&s.TO_ID_VALUE,B=o=j[Z+n.topRight]&s.TO_ID_VALUE,W=r=j[Z+n.bottomLeft]&s.TO_ID_VALUE,k=u=j[Z+n.bottom]&s.TO_ID_VALUE,V=h=j[Z+n.bottomRight]&s.TO_ID_VALUE),((l[a].FLAG|l[i].FLAG|l[o].FLAG|l[r].FLAG|l[u].FLAG|l[h].FLAG)&e)===e}function G(t,e,n){var a;e=Math.abs(~~e),l[e]&&(a=I(t),l[j[Z+a.bottomLeft]&s.TO_ID_VALUE].FLAG&n&&(j[Z+a.bottomLeft]=e),l[j[Z+a.bottom]&s.TO_ID_VALUE].FLAG&n&&(j[Z+a.bottom]=e),l[j[Z+a.bottomRight]&s.TO_ID_VALUE].FLAG&n&&(j[Z+a.bottomRight]=e),l[j[Z+a.topLeft]&s.TO_ID_VALUE].FLAG&n&&(j[Z+a.topLeft]=e),l[j[Z+a.top]&s.TO_ID_VALUE].FLAG&n&&(j[Z+a.top]=e),l[j[Z+a.topRight]&s.TO_ID_VALUE].FLAG&n&&(j[Z+a.topRight]=e))}function w(t,e){var n;e=Math.abs(~~e),l[e]&&(n=I(t),j[Z+n.bottomLeft]=e,j[Z+n.bottom]=e,j[Z+n.bottomRight]=e,j[Z+n.topLeft]=e,j[Z+n.top]=e,j[Z+n.topRight]=e)}var H,C,F,B,W,k,V,X=4092&Math.abs(~~t),K=4092&Math.abs(~~e),Y=X*K,z=new ArrayBuffer(14*Y),j=new Uint8Array(z),q=new Uint32Array(Y),J={},$={},Q=0,Z=Y,tt=4*Y,et=5*Y,nt=8*Y,at=9*Y,it=10*Y,ot=12*Y,rt=13*Y;return function(t){for(t=at;at+Y>t;t++)j[t]=7}(),{calculateAreaMap:n,calculateLightMap:a,calculateSiteMap:T,changeHeight:g,getAllSitesOfType:L,getBlock:M,getNodesByIndex:b,getRadiusNodes:O,getRawData:U,getTextureNodesByIndex:I,getTexturesByIndex:y,initializeHeight:x,initializeObjects:D,initializeTexture:P,isAnyTextureWithAnyOfFlags:v,isEachTextureSame:S,isEachTextureWithAnyOfFlags:N,isMixedTextureWithAllOfFlags:_,replaceTextureAnyOfFlags:G,setTexture:w}};t.exports=T},function(t,e,n){"use strict";t.exports=n(1),n(14),n(15),n(16)},function(t,e,n){"use strict";var a=n(1),i=n(2);t.exports=a,a.prototype.done=function(t,e){var n=arguments.length?this.then.apply(this,arguments):this;n.then(null,function(t){i(function(){throw t})})}},function(t,e,n){"use strict";function a(t){this.then=function(e){return"function"!=typeof e?this:new i(function(n,a){o(function(){try{n(e(t))}catch(i){a(i)}})})}}var i=n(1),o=n(2);t.exports=i,a.prototype=i.prototype;var r=new a(!0),s=new a(!1),l=new a(null),u=new a(void 0),h=new a(0),E=new a("");i.resolve=function(t){if(t instanceof i)return t;if(null===t)return l;if(void 0===t)return u;if(t===!0)return r;if(t===!1)return s;if(0===t)return h;if(""===t)return E;if("object"==typeof t||"function"==typeof t)try{var e=t.then;if("function"==typeof e)return new i(e.bind(t))}catch(n){return new i(function(t,e){e(n)})}return new a(t)},i.all=function(t){var e=Array.prototype.slice.call(t);return new i(function(t,n){function a(o,r){try{if(r&&("object"==typeof r||"function"==typeof r)){var s=r.then;if("function"==typeof s)return void s.call(r,function(t){a(o,t)},n)}e[o]=r,0===--i&&t(e)}catch(l){n(l)}}if(0===e.length)return t([]);for(var i=e.length,o=0;o<e.length;o++)a(o,e[o])})},i.reject=function(t){return new i(function(e,n){n(t)})},i.race=function(t){return new i(function(e,n){t.forEach(function(t){i.resolve(t).then(e,n)})})},i.prototype["catch"]=function(t){return this.then(null,t)}},function(t,e,n){"use strict";var a=n(1),i=n(2);t.exports=a,a.denodeify=function(t,e){return e=e||1/0,function(){var n=this,i=Array.prototype.slice.call(arguments);return new a(function(a,o){for(;i.length&&i.length>e;)i.pop();i.push(function(t,e){t?o(t):a(e)});var r=t.apply(n,i);!r||"object"!=typeof r&&"function"!=typeof r||"function"!=typeof r.then||a(r)})}},a.nodeify=function(t){return function(){var e=Array.prototype.slice.call(arguments),n="function"==typeof e[e.length-1]?e.pop():null,o=this;try{return t.apply(this,arguments).nodeify(n,o)}catch(r){if(null===n||"undefined"==typeof n)return new a(function(t,e){e(r)});i(function(){n.call(o,r)})}}},a.prototype.nodeify=function(t,e){return"function"!=typeof t?this:void this.then(function(n){i(function(){t.call(e,null,n)})},function(n){i(function(){t.call(e,n)})})}}]);